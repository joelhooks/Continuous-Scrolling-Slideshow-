/* * Continuous Scrolling Slideshow  * Created by Joel Hooks | joelhooks@gmail.com  * Feel free to use this however you like, but leave this comment intact. */package com.visualempathy.slideshow.view.components {		import com.visualempathy.slideshow.model.vo.AlbumVO;	import com.visualempathy.slideshow.model.vo.ImageVO;		import flash.events.Event;	import flash.events.TimerEvent;	import flash.utils.Timer;		import mx.core.UIComponent;	/**	 * Based on the work of Peter Wright:	 * http://www.f-90.co.uk/blog/	 * 	 * This is a slide panel thumbnail navigator for displaying	 * a continuous scrolling list of thumbnail images for use	 * in slideshows and other navigation.	 *  	 * @author Joel Hooks	 * 	 */		public class Navigator extends UIComponent {				public static const NAV_ITEM_CLICKED:String = "veThumbNavigatorItemClicked";		public static const INIT_COMPLETE:String = "veThumbNavigatorInitComplete";		/**		 * Array of NavItem objects to display in the scroll list 		 */				private var _navArray	:Array;		/**		 * Currently selected NavItem 		 */				private var selectedItem		:Thumbnail;		/**		 * Damping applied to TweenLight movements.		 * Affects the speed at which items scroll		 * when a NavItem is clicked		 */		private var _damping	:Number		= 10;		/**		 * The center point on the xAxis. Used as a target		 * for lining the selected NavItem in the center		 * 		 * TODO: Add centerY for vertical layout, add ability		 * to update based on current application size 		 */		private var _centerX	:Number		= 200;		public function set centerX( value:Number ):void { _centerX = value }		/**		 * The sum of all the NavItem widths 		 */		private var totalWidth	:Number		= 0;		/**		 * The current width of the container.		 * 		 * TODO: containerHeight for vertical layouts.		 * Update on app resize. 		 */		private var _containerWidth:Number = 0;		/**		 * The width of an individual item. 		 * 		 * TODO: This should be changed to accept variables		 * as well as adding a height for vertical layouts. 		 */				private var _itemWidth:Number = 0;		/**		 * A timer for slideshow playback 		 */		public var timer:Timer;		/**		 * The current slide in a slide show 		 */		private var currentSlide:int = 0;		private var _slideDelaySeconds:Number = 3;				[Bindable] public var slideshow:Boolean = false;				public var album:AlbumVO;				/**		 * Constructor for Navigator		 *  		 * @param images XML list of images to load		 * @param damping Controls the transition speed as list scrolls		 * @param thumbSize the size of the thumbnail object		 * @param centerX The mid-point.		 * @param containerWidth The width of the container holding the navigator.		 * @param slideShow is this a slideshow?		 * @param slideDelatSeconds how many seconds to hold each fram in a slideshow.		 * 		 */					public function Navigator(album:AlbumVO, damping:Number, centerX:Number, containerWidth:Number, slideshow:Boolean = false, slideDelaySeconds:Number = 3){			_damping	= damping;			_centerX	= centerX;			_navArray	= [];			_containerWidth = containerWidth;			_slideDelaySeconds = slideDelaySeconds			this.album = album;			this.slideshow = slideshow;			initializeThumbnails( );						if( this.slideshow )			{	 			startSlideshow( )					}		}		private function initializeThumbnails( ):void		{			var count:int = 0;			for each( var image:ImageVO in album.images )			{				var navItem:Thumbnail = new Thumbnail(count, album.tnPath + image.filename, 85 );				navItem.addEventListener(Thumbnail.EVENT_CLICKED, thumbClickHandler);				navItem.addEventListener(Thumbnail.SELECT, centerNav);								navItem.imageVO = image;				addChild(navItem)				_navArray.push(navItem)				totalWidth+=navItem.width				count = count + 1			}				selectFirstThumbnail( )					dispatchEvent( new Event( Navigator.INIT_COMPLETE, true ) );			}				/**		 * Start the slideshow 		 */				public function startSlideshow( ):void		{			if( !timer )			{				onTimer( );	 			timer = new Timer( _slideDelaySeconds * 1000 )	 			timer.addEventListener( TimerEvent.TIMER, onTimer );	 				 			timer.start();		 			slideshow = true;							}		}				/**		 * Stop the slideshow		 */				public function stopSlideshow( ):void		{			if( timer )			{				timer.removeEventListener( TimerEvent.TIMER, onTimer );				timer.stop();				timer = null;				slideshow = false;							}		}				/**		 * "Click" the next image in the sequence. 		 *  		 * @param te		 * @private		 */				private function onTimer( te:TimerEvent = null ):void		{			selectNext();		}				/**		 * Select the next thumbnail in the album 		 */		public function selectNext( ):void		{			select( );		}				/**		 * Select the previous thumbnail in the album 		 */				public function selectPrevious( ):void		{			select( -1 );		}				/**		 * @private		 */					private function selectFirstThumbnail( ):void		{			_navArray[0].dispatchEvent( new Event( Thumbnail.EVENT_CLICKED ) );		}				/**		 * @private		 */				private function select( increment:int = 1 ):void		{			var selectItemNumber:int = selectedItem.referenceNumber + increment;						if( selectedItem.referenceNumber + increment < 0 )			{				 selectItemNumber = navArray.length - 1			}			else if ( selectedItem.referenceNumber + increment == navArray.length )			{				selectItemNumber = 0			}						getThumbnailFromRefNumber( selectItemNumber ).dispatchEvent( new Event( Thumbnail.SELECT, true ) );		}				/**		 * @private		 */		private function getThumbnailFromRefNumber( refNum:int ):Thumbnail		{			for each( var thumbnail:Thumbnail in _navArray )			{				if( thumbnail.referenceNumber == refNum )					return thumbnail;			}			return null;		}				/**		 * Shifts the images to keep the continuous scroll continuous		 * @private		 */				private function swap():void {			alignThumbnails();						var left:Thumbnail = _navArray[0];			var right:Thumbnail = _navArray[_navArray.length-1];						for (var i:int = 0; i<_navArray.length; i++) {				if (left.x<0-left.width) {					// moves clips from first to last					_navArray.push(_navArray.shift());					left.x = right.x+right.width;				}				                       				if (right.x>totalWidth-right.width) {					// moves clips from last to first					_navArray.unshift(_navArray.pop());					right.x = left.x-right.width;				}			}		}				private function thumbClickHandler(e:Event):void		{			centerNav(e);			dispatchEvent( new Event( Navigator.NAV_ITEM_CLICKED, true ) );		}				/**		 * Moves the selected NavItem to the center of the navigation container. 		 * @private		 */				private function centerNav(e:Event):void 		{			removeEventListener(Event.ENTER_FRAME, setPositions);				selectedItem = e.target as Thumbnail;			for (var i:int = 0; i<_navArray.length; i++) {				if(navArray[i]!=selectedItem)				{					navArray[i].enable();				} 				else				{					navArray[i].disable();				} 			}			album.selectedImage = selectedItem.imageVO;			addEventListener(Event.ENTER_FRAME, setPositions);		}				/**		 * Set the positions of the NavItems 		 * @param e		 * @private		 */				private function setPositions(e:Event = null):void {			var thisX	:Number	= selectedItem.x+selectedItem.width;			var deltaX	:Number	= thisX-(_centerX + selectedItem.width / 2 );			_navArray[0].x -= deltaX/_damping;			swap();						if (Math.abs(deltaX)<1) {				removeEventListener(Event.ENTER_FRAME, setPositions);				}		}		/**		 * Make sure all of the NavItems stay aligned while they are swapped 		 * @private		 */				private function alignThumbnails():void {			for (var i:int = 1; i<_navArray.length; i++) {				_navArray[i].x = _navArray[i-1].x+_navArray[i-1].width;			}		}				/**		 * An array of NavItems		 * @return 		 * 		 */				public function get navArray():Array { return _navArray; }			}	}